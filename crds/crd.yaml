# Berg Operator CRDs
# Generated by crdgen
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: challenges.berg.norelect.ch
spec:
  group: berg.norelect.ch
  names:
    categories: []
    kind: Challenge
    plural: challenges
    shortNames: []
    singular: challenge
  scope: Namespaced
  versions:
  - additionalPrinterColumns: []
    name: v1
    schema:
      openAPIV3Schema:
        description: Auto-generated derived type for ChallengeSpec via `CustomResource`
        properties:
          spec:
            description: Challenge resource (read-only from controller perspective)
            properties:
              allowOutboundTraffic:
                type: boolean
              attachments:
                items:
                  properties:
                    downloadImage:
                      nullable: true
                      type: string
                    downloadImageInsecure:
                      nullable: true
                      type: boolean
                    downloadImagePullSecret:
                      nullable: true
                      type: string
                    downloadUrl:
                      nullable: true
                      type: string
                    fileName:
                      type: string
                  required:
                  - fileName
                  type: object
                nullable: true
                type: array
              author:
                type: string
              categories:
                items:
                  type: string
                type: array
              containers:
                items:
                  properties:
                    additionalCapabilities:
                      default: []
                      items:
                        type: string
                      type: array
                    dynamicFlag:
                      nullable: true
                      properties:
                        content:
                          nullable: true
                          properties:
                            mode:
                              format: uint32
                              minimum: 0.0
                              nullable: true
                              type: integer
                            path:
                              type: string
                          required:
                          - path
                          type: object
                        env:
                          nullable: true
                          properties:
                            name:
                              type: string
                          required:
                          - name
                          type: object
                        executable:
                          nullable: true
                          properties:
                            mode:
                              format: uint32
                              minimum: 0.0
                              nullable: true
                              type: integer
                            path:
                              type: string
                          required:
                          - path
                          type: object
                      type: object
                    egressBandwidth:
                      nullable: true
                      type: string
                    environment:
                      additionalProperties:
                        type: string
                      default: {}
                      type: object
                    hostname:
                      type: string
                    image:
                      type: string
                    ingressBandwidth:
                      nullable: true
                      type: string
                    livenessProbe:
                      description: Kubernetes probe configuration (exec, httpGet, tcpSocket, or grpc)
                      nullable: true
                      type: object
                      x-kubernetes-preserve-unknown-fields: true
                    ports:
                      items:
                        properties:
                          appProtocol:
                            nullable: true
                            type: string
                          name:
                            type: string
                          port:
                            format: uint16
                            maximum: 65535.0
                            minimum: 0.0
                            type: integer
                          protocol:
                            type: string
                          type:
                            enum:
                            - internalPort
                            - publicPort
                            - publicHttpRoute
                            - publicTlsRoute
                            type: string
                        required:
                        - name
                        - port
                        - protocol
                        - type
                        type: object
                      type: array
                    readinessProbe:
                      description: Kubernetes probe configuration (exec, httpGet, tcpSocket, or grpc)
                      nullable: true
                      type: object
                      x-kubernetes-preserve-unknown-fields: true
                    resourceLimits:
                      nullable: true
                      properties:
                        cpu:
                          nullable: true
                          type: string
                        memory:
                          nullable: true
                          type: string
                      type: object
                    resourceRequests:
                      nullable: true
                      properties:
                        cpu:
                          nullable: true
                          type: string
                        memory:
                          nullable: true
                          type: string
                      type: object
                    runtimeClassName:
                      nullable: true
                      type: string
                  required:
                  - hostname
                  - image
                  - ports
                  type: object
                type: array
              description:
                type: string
              difficulty:
                type: string
              displayName:
                nullable: true
                type: string
              dynamicFlagMode:
                enum:
                - suffix
                - leetify
                - null
                nullable: true
                type: string
              event:
                nullable: true
                type: string
              flag:
                type: string
              flagFormat:
                type: string
              hideUntil:
                format: date-time
                nullable: true
                type: string
              staticValue:
                format: double
                nullable: true
                type: number
              tags:
                default: []
                items:
                  type: string
                type: array
            required:
            - allowOutboundTraffic
            - author
            - categories
            - containers
            - description
            - difficulty
            - flag
            - flagFormat
            type: object
        required:
        - spec
        title: Challenge
        type: object
    served: true
    storage: true
    subresources: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: challengeinstances.berg.norelect.ch
spec:
  group: berg.norelect.ch
  names:
    categories: []
    kind: ChallengeInstance
    plural: challengeinstances
    shortNames:
    - ci
    - instance
    singular: challengeinstance
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.challengeRef.name
      name: Challenge
      type: string
    - jsonPath: .spec.ownerId
      name: Owner
      type: string
    - jsonPath: .status.phase
      name: Phase
      type: string
    - jsonPath: .status.namespace
      name: Namespace
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    - jsonPath: .status.expiresAt
      name: Expires
      type: date
    name: v1
    schema:
      openAPIV3Schema:
        description: Auto-generated derived type for ChallengeInstanceSpec via `CustomResource`
        properties:
          spec:
            description: ChallengeInstance is the primary resource managed by this controller
            properties:
              challengeRef:
                description: Reference to the Challenge resource
                properties:
                  name:
                    type: string
                  namespace:
                    nullable: true
                    type: string
                required:
                - name
                type: object
              flag:
                description: Pre-generated flag for this instance
                maxLength: 1024
                type: string
              instanceClass:
                description: |-
                  ChallengeInstanceClass to use for this instance
                  If not specified, the default class will be used
                nullable: true
                type: string
              ownerId:
                description: UUID of the owner (player/team)
                pattern: ^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$
                type: string
              terminationReason:
                description: Reason for termination
                enum:
                - UserRequest
                - Timeout
                - AdminTermination
                - null
                nullable: true
                type: string
              timeout:
                default: 2h
                description: Duration after which instance auto-terminates (e.g., "2h", "30m")
                nullable: true
                pattern: ^([0-9]+h)?([0-9]+m)?([0-9]+s)?$
                type: string
            required:
            - challengeRef
            - flag
            - ownerId
            type: object
          status:
            nullable: true
            properties:
              conditions:
                default: []
                description: Status conditions
                items:
                  properties:
                    lastTransitionTime:
                      format: date-time
                      nullable: true
                      type: string
                    message:
                      nullable: true
                      type: string
                    reason:
                      nullable: true
                      type: string
                    status:
                      enum:
                      - 'True'
                      - 'False'
                      - Unknown
                      type: string
                    type:
                      type: string
                  required:
                  - status
                  - type
                  type: object
                type: array
              expiresAt:
                format: date-time
                nullable: true
                type: string
              instanceId:
                description: Generated UUID for this instance
                nullable: true
                type: string
              namespace:
                description: Namespace containing instance resources
                nullable: true
                type: string
              observedGeneration:
                description: Last observed generation
                format: int64
                nullable: true
                type: integer
              phase:
                description: Current lifecycle phase
                enum:
                - Pending
                - Creating
                - Starting
                - Running
                - Terminating
                - Terminated
                - Failed
                - null
                nullable: true
                type: string
              readyAt:
                format: date-time
                nullable: true
                type: string
              services:
                default: []
                description: Service endpoints
                items:
                  properties:
                    appProtocol:
                      nullable: true
                      type: string
                    hostname:
                      type: string
                    name:
                      type: string
                    port:
                      format: uint16
                      maximum: 65535.0
                      minimum: 0.0
                      type: integer
                    protocol:
                      type: string
                    tls:
                      nullable: true
                      type: boolean
                  required:
                  - hostname
                  - name
                  - port
                  - protocol
                  type: object
                type: array
              startedAt:
                description: Timestamps (RFC3339 format)
                format: date-time
                nullable: true
                type: string
              terminatedAt:
                format: date-time
                nullable: true
                type: string
            type: object
        required:
        - spec
        title: ChallengeInstance
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: challengeinstanceclasses.berg.norelect.ch
spec:
  group: berg.norelect.ch
  names:
    categories: []
    kind: ChallengeInstanceClass
    plural: challengeinstanceclasses
    shortNames: []
    singular: challengeinstanceclass
  scope: Cluster
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.gateway.name
      name: Gateway
      type: string
    - jsonPath: .spec.default
      name: Default
      type: boolean
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1
    schema:
      openAPIV3Schema:
        description: Auto-generated derived type for ChallengeInstanceClassSpec via `CustomResource`
        properties:
          spec:
            description: |-
              ChallengeInstanceClass defines configuration for ChallengeInstances
              Similar to StorageClass in Kubernetes, this allows different "tiers" of instances
            properties:
              default:
                default: false
                description: Whether this is the default class
                type: boolean
              defaultResources:
                description: Default resource requests for challenge containers
                nullable: true
                properties:
                  cpuLimit:
                    description: Default CPU limit (e.g., "500m")
                    nullable: true
                    type: string
                  cpuRequest:
                    description: Default CPU request (e.g., "100m")
                    nullable: true
                    type: string
                  memoryLimit:
                    description: Default memory limit (e.g., "512Mi")
                    nullable: true
                    type: string
                  memoryRequest:
                    description: Default memory request (e.g., "128Mi")
                    nullable: true
                    type: string
                type: object
              defaultTimeout:
                description: Default timeout for instances using this class
                nullable: true
                type: string
              gateway:
                description: Gateway configuration for routing challenge traffic
                properties:
                  domain:
                    description: Challenge domain for routing (e.g., challenges.example.com)
                    type: string
                  httpListenerName:
                    description: HTTP listener name in the Gateway
                    type: string
                  httpPort:
                    default: 80
                    description: HTTP port exposed by the Gateway
                    format: uint16
                    maximum: 65535.0
                    minimum: 0.0
                    type: integer
                  name:
                    description: Gateway name
                    type: string
                  namespace:
                    description: Gateway namespace
                    type: string
                  tlsListenerName:
                    description: TLS listener name in the Gateway
                    type: string
                  tlsPort:
                    default: 443
                    description: TLS port exposed by the Gateway
                    format: uint16
                    maximum: 65535.0
                    minimum: 0.0
                    type: integer
                required:
                - domain
                - httpListenerName
                - name
                - namespace
                - tlsListenerName
                type: object
              imagePull:
                description: Image pull configuration
                nullable: true
                properties:
                  policy:
                    default: IfNotPresent
                    description: Image pull policy (Always, IfNotPresent, Never)
                    type: string
                  secretName:
                    description: Name of secret containing registry credentials
                    nullable: true
                    type: string
                type: object
              network:
                description: Network configuration
                nullable: true
                properties:
                  additionalHeadlessService:
                    default: false
                    description: Enable additional headless service for containers
                    type: boolean
                  egressBandwidth:
                    description: Default egress bandwidth limit (e.g., "10M")
                    nullable: true
                    type: string
                  ingressBandwidth:
                    description: Default ingress bandwidth limit (e.g., "10M")
                    nullable: true
                    type: string
                type: object
              security:
                description: Security and runtime configuration
                nullable: true
                properties:
                  podSecurityContext:
                    description: Pod security context settings
                    nullable: true
                    properties:
                      fsGroup:
                        description: FS group for volumes
                        format: int64
                        nullable: true
                        type: integer
                      runAsNonRoot:
                        description: Run as non-root user
                        nullable: true
                        type: boolean
                      supplementalGroups:
                        description: Supplemental groups
                        items:
                          format: int64
                          type: integer
                        nullable: true
                        type: array
                    type: object
                  runtimeClassName:
                    description: RuntimeClass to use for pods
                    nullable: true
                    type: string
                type: object
            required:
            - gateway
            type: object
        required:
        - spec
        title: ChallengeInstanceClass
        type: object
    served: true
    storage: true
    subresources: {}
